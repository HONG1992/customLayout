---
title: "Layouts for officer's PowerPoint documents."
author: "Zygmunt Zawadzki"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Introduction

This document shows how to work with PowerPoint files in R using customLayout approach.

Let's start by creating a layout. `lay` and `lay2` will be used to store the content of the slide (plots, tables, text), and `titleLay` will serve as a container for the title of the slide. 

It seems that merging the title placeholder in the last step allows to the easy control its ratio to the content of the slide. Note that `titleLay` is merged with `lay3` (combination of `lay` and `lay2`) using a ratio 1:7, so the content of the slide will occupy about 87,5% of the area (`7/(1+7)`). 

```{r}
library(customLayout)
library(officer)
library(magrittr)
library(ggplot2)

lay  <- lay_new(matrix(1:4,nc=2),widths=c(3,2),heights=c(2,1))
lay2 <- lay_new(matrix(1:3))
titleLay <- lay_new(1, widths = 1, heights = 1)

lay3   <- lay_bind_col(lay,lay2, widths=c(3,1))
layout <- lay_bind_row(titleLay, lay3, heights = c(1,7))

lay_show(layout)
```

In the next step, one needs to create an officer layout from an existing `layout` object. It is done by calling `phl_layout`, which allows specifying the target size of the slide and margins.

```{r}
## create officer layout
offLayout <- phl_layout(layout,
    margins = c(0.25, 0.25, 0.25, 0.25),
    innerMargins = rep(0.15,4))
```

## `ggplot2`

Then, the elements of the slide are added using functions with `phl_*` prefix. The code below adds two ggplot plots into the slide using `phl_with_gg`.

```{r}
pptx <- read_pptx() %>%
  add_slide(master = "Office Theme", layout = "Title and Content")

### fill first placeholder

plot1 <- qplot(mpg, wt, data = mtcars)
plot3 <- qplot(mpg, qsec, data = mtcars)
pptx <- phl_with_gg(pptx, offLayout, 2, plot1)
pptx <- phl_with_gg(pptx, offLayout, 4, plot3)
```

![](power-point/officer-gg.png)

## Base graphics

It is also worth to note that pptx files allow intermixing base graphics with grid graphics (ggplot2 and friends). The example below adds a few pie charts (note from the author - I'm not a fan of pie charts. Please don't use them on real slides). In this case `phl_with_plot` requires a function which creates a plot.

```{r}
pl5 <- function() {
  par(mar = rep(0.1, 4))
  pie(c(3, 4, 6), col = 2:4)
}
pl6 <- function() {
  par(mar = rep(0.1, 4))
  pie(c(3, 2, 7), col = 2:4 + 3)
}
pl7 <- function() {
  par(mar = rep(0.1, 4))
  pie(c(5, 4, 2), col = 2:4 + 6)
}

pptx <- phl_with_plot(pptx, offLayout, 6, pl5)
pptx <- phl_with_plot(pptx, offLayout, 7, pl6)
pptx <- phl_with_plot(pptx, offLayout, 8, pl7)
```

![](power-point/officer-plots.png)

## Basic tables

To export data.frame to the slide, one needs to use `phl_with_table`. 

```{r}
pptx <- phl_with_table(pptx, offLayout, 3, head(iris, 2))
```

Note, that in the current version `customLayout` is not able to fit the table perfectly to your slide. The desired width will be matched at the expense of the table height and text-wrapping. See the output slide created from the code above. As you can see, the table is a bit too tall, and the texts in cells are inelegantly wrapped.

![](power-point/officer-table.png)

## Text

Inserting the text works in a very similar fashion to the officer package, just use the `phl_with_text` function. To add the formatting to the text use the `style` argument as in the example below (`phl_with_text` internally uses `officer::ph_add_text`).

```{r}
pptx <- phl_with_text(pptx, offLayout, 1, "Custom Layout")

style <- fp_text(font.size = 24, color = "red")
pptx  <- phl_with_text(pptx, offLayout, 5, 
          "Lorem ipsum", type = "body", style = style)
```

![](power-point/officer-text.png)

## Render document

```{r, eval=FALSE}
file <- tempfile(fileext = ".pptx")
print(pptx, file)
```

## `flextable`s
